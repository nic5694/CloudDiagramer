from google.cloud import storage
import uuid
import io


def upload_diagram_to_bucket(image_data, content_type="image/png"):
    bucket_name = "pumldiagrambucket"
    destination_blob_name = f"{uuid.uuid4().hex}.png"
    
    storage_client = storage.Client()
    bucket = storage_client.bucket(bucket_name)
    blob = bucket.blob(destination_blob_name)

    generation_match_precondition = 0
    if isinstance(image_data, str):
        blob.upload_from_filename(
            image_data, 
            content_type=content_type,
            if_generation_match=generation_match_precondition
        )
    elif isinstance(image_data, bytes):
        blob.upload_from_string(
            image_data,
            content_type=content_type,
            if_generation_match=generation_match_precondition
        )
    else:
        blob.upload_from_file(
            image_data,
            content_type=content_type,
            if_generation_match=generation_match_precondition
        )
    
    print(f"Image uploaded to {destination_blob_name}")
    
    return {f"https://storage.googleapis.com/{bucket_name}/{destination_blob_name}"}